<!DOCTYPE html>
<html lang="hu">

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, 
                                   initial-scale=1, 
                                   shrink-to-fit=no" />

	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>VPN|VNC</title>
	<base target="_self">

	<link rel="stylesheet" href="root-directories/root-css/style.css?t=123" />
</head>

<body>
	<div id="topmenu" class="topmenu">
		<a class="megalink" href="#start" target="_self">
			To the top
		</a>
	</div>

	<article id="start" class="container">

		<header>
			<h1>
				Open VPN on Ubuntu
			</h1>

			<h2>
				VPN
			</h2>
		</header>

		<p>
			OpenVPN is a Virtual Private Networking (VPN) solution provided in the Ubuntu Repositories.
			It is flexible, reliable and secure.
			It belongs to the family of SSL/TLS VPN stacks (different from IPSec VPNs).
			This chapter will cover installing and configuring OpenVPN to create a VPN.
		</p>

		<article id="chapter-intro">
			<header>
				<h3>
					OpenVPN
				</h3>
			</header>

			<figure>
				<img src="images/openVPN.png" alt="openVPN" title="openVPN" width="auto" height="auto" />
			</figure>
			<p>
				If you want more than just pre-shared keys OpenVPN makes it easy
				to set up a Public Key Infrastructure (PKI) to use SSL/TLS certificates
				for authentication and key exchange between the VPN server and clients.
				OpenVPN can be used in a routed or bridged VPN mode
				and can be configured to use either UDP or TCP.
				The port number can be configured as well,
				but port 1194 is the official one;
				this single port is used for all communication.
				VPN client implementations are available for almost anything
				including all Linux distributions, OS X, Windows and OpenWRT based WLAN routers.
			</p>

			<article>
				<header>
					<h3>
						Server Installation
					</h3>
				</header>

				<p>
					To install openvpn in a terminal enter:
				</p>
				<p>
					<code>
						$ sudo apt install openvpn easy-rsa
					</code>
				</p>
			</article>
			<article>
				<header>
					<h3>
						Public Key Infrastructure Setup
					</h3>
				</header>

				<p>
					The first step in building an OpenVPN configuration
					is to establish a PKI (public key infrastructure).
					The PKI consists of:
				</p>
				<ul>
					<li>
						a separate certificate (also known as a public key)
						and private key for the server and each client.
					</li>
					<li>
						a master Certificate Authority (CA) certificate and key,
						used to sign the server and client certificates.
					</li>
				</ul>
				<p>
					OpenVPN supports bidirectional authentication based on certificates,
					meaning that the client must authenticate the server certificate
					and the server must authenticate the client certificate
					before mutual trust is established.
				</p>
				<p>
					Both server and client will authenticate the other by first
					verifying that the presented certificate was signed
					by the master certificate authority (CA),
					and then by testing information in the now-authenticated certificate header,
					such as the certificate common name or certificate type (client or server).
				</p>

				<article>
					<header>
						<h3>
							Certificate Authority Setup
						</h3>
					</header>

					<p>
						To setup your own Certificate Authority (CA) and generate certificates
						and keys for an OpenVPN server and multiple clients
						first copy the easy-rsa directory to /etc/openvpn.
						This will ensure that any changes to the scripts
						will not be lost when the package is updated.
						From a terminal, run:
					</p>
					<p>
						<code>
							$ sudo make-cadir /etc/openvpn/easy-rsa
						</code>
					</p>

					<p>
						As root user (run: $ <code>sudo -i</code>) change
						to the newly created directory /etc/openvpn/easy-rsa and run:
					</p>
					<p>
						<code>
							# ./easyrsa init-pki
						</code>
					</p>
					<p>
						<code>
							# ./easyrsa build-ca
						</code>
					</p>
				</article>

				<article>
					<header>
						<h3>
							Server Keys and Certificates
						</h3>
					</header>

					<p>
						Next, we will generate a key pair for the server:
					</p>
					<p>
						<code>
							# ./easyrsa gen-req myservername nopass
						</code>
					</p>

					<p>
						Diffie Hellman parameters must be generated for the OpenVPN server.
						The following will place them in pki/dh.pem:
					</p>
					<p>
						<code>
							# ./easyrsa gen-dh
						</code>
					</p>

					<p>
						And finally a certificate for the server:
					</p>
					<p>
						<code>
							# ./easyrsa gen-req myservername nopass
						</code>
					</p>
					<p>
						<code>
							# ./easyrsa sign-req server myservername
						</code>
					</p>
					<p>
						All certificates and keys have been generated in subdirectories.
						Common practice is to copy them to /etc/openvpn/:
					</p>
					<figure>
						<img src="images/certificates.png" alt="certificates" title="certificates"
							style="width: 640px; max-width: 100%; height: auto;" />
					</figure>
				</article>

				<article>
					<header>
						<h3>
							Client Certificates
						</h3>
					</header>

					<p>
						The VPN client will also need a certificate to authenticate itself to the server.
						Usually you create a different certificate for each client.
					</p>
					<p>
						This can either be done on the server (as the keys and certificates above)
						and then securely distributed to the client.
						Or vice versa: the client can generate
						and submit a request that is sent and signed by the server.
					</p>
					<p>
						To create the certificate, enter the following
						in a terminal while being user root:
					</p>
					<p>
						<code>
							# ./easyrsa gen-req myclient1 nopass
						</code>
					</p>
					<p>
						<code>
							# ./easyrsa sign-req client myclient1
						</code>
					</p>
					<p>
						afterwards copy the following files to the client using a secure method:
					</p>
					<ul>
						<li>
							<code>pki/ca.crt</code>
						</li>
						<li>
							<code>pki/issued/myclient1.crt</code>
						</li>
					</ul>
					<p>
						As the client certificates and keys are only required on the client machine,
						you can remove them from the server.
					</p>
				</article>
			</article>
			<article>
				<header>
					<h3>
						Simple Server Configuration
					</h3>
				</header>

				<p>
					Along with your OpenVPN installation you got these sample config files
					(and many more if you check):
				</p>
				<p>
					<code>
						# ls -l /usr/share/doc/openvpn/examples/sample-config-files/
					</code>
				</p>
				<p>
					Start with copying and unpacking <code>server.conf.gz</code>
					to <code>/etc/openvpn/server.conf</code>.
				</p>
				<p>
					Edit <code>/etc/openvpn/myserver.conf</code> to make sure the following lines
					are pointing to the certificates and keys you created in the section above.
				</p>
				<ul type="none">
					<li>
						<code>
							ca ca.crt
						</code>
					</li>
					<li>
						<code>
							cert myservername.crt
						</code>
					</li>
					<li>
						<code>
							key myservername.key
						</code>
					</li>
					<li>
						<code>
							dh dh.pem
						</code>
					</li>
				</ul>
				<p>
					Complete this set with a ta key
					in <code>etc/openvpn</code> for tls-auth like:
				</p>
				<p>
					<code>
						# openvpn --genkey --secret ta.key
					</code>
				</p>
				<p>
					Edit <code>/etc/sysctl.conf</code> and 
					uncomment (= remove the # from start of the line) 
					the following line to enable IP forwarding:
				</p>
				<p>
					<code>
						#net.ipv4.ip_forward=1
					</code>
				</p>
				<p>
					Then reload <code>sysctl</code>.
				</p>
				<p>
					<code>
						# sysctl -p /etc/sysctl.conf
					</code>
				</p>
			</article>
		</article>

		<footer>
			<p>
				AD MMXXI-
			</p>
		</footer>
	</article>

	<script>

	</script>
</body>

</html>